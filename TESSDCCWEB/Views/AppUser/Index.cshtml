@{
    ViewBag.Title = "Application Users";
    Layout = "~/Views/Shared/_Default.cshtml";
}

<div class="row" >
    <div class="col-xs-12 col-md-12">
        <div class="widget">
            <div class="widget-header" >
                <span class="widget-caption topfocus" tabindex='1'><b>Application User List</b></span>
                <div class="widget-buttons">
                    <div id="adddiv">
                        <a href="javascript:displayAddDiv();" class="btn btn-azure btn-xs add" style="font-size:13px;font-weight:bold;">
                            <i class="fa fa-plus-circle"></i> Add New User
                        </a>
                    </div>
                </div>
            </div>            
            <div id="divnew" class="widget-body " >
                <div class="form-horizontal">
                    <div class="row">
                        <div class="col-lg-12 col-sm-12 col-xs-12">
                            <div class="row mantable">
                                <div class="col-lg-6 col-sm-6 col-xs-12">
                                    <div class="form-group">
                                        <label class="control-label col-lg-3">First Name<span class="mandatory">*</span></label>
                                        <div class=" col-lg-8">
                                            <div id="divID" style="display:none;"></div>
                                            <input title="First Name" class="form-control manfield" id="txt1" name="txt1" type="text" maxlength="100">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-lg-3">Email  ID<span class="mandatory">*</span></label>
                                        <div class=" col-lg-8">
                                            <input class="form-control manfield propemail" id="txt3" name="txt3" type="text" maxlength="50" title="Email ID">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-lg-3 control-label">Date of Birth</label>
                                        <div class="col-lg-8">
                                            <div class="input-group">
                                                <input readonly="readonly" class="form-control date-picker" id="date1" type="text" data-date-format="dd-mm-yyyy">
                                                <span class="input-group-addon">
                                                    <i class="fa fa-calendar"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-lg-3 control-label">Roles</label>
                                        <div class="col-lg-8">
                                            <select multiple="multiple" id="ddlMultiple" style="width:100%;"></select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-sm-6 col-xs-12">
                                    <div class="form-group">
                                        <label class="control-label col-lg-3">Last Name</label>
                                        <div class=" col-lg-8">
                                            <input class="form-control" id="txt2" name="txt2" type="text" maxlength="25">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-lg-3">Mobile</label>
                                        <div class=" col-lg-8">
                                            <input class="form-control" id="txt4" name="txt4" type="text" onkeydown="AllowNumbers(event);" maxlength="10">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-lg-3 control-label">Gender</label>
                                        <div class="col-lg-8">
                                            <div class="row">
                                                <div class="col-lg-3 col-sm-3 col-xs-3">
                                                    <div class="radio">
                                                        <label>
                                                            <input id="rbn1" checked="checked" class="" name="form-field-radio" type="radio"><span class="text"> Male</span>
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4 col-sm-4 col-xs-4">
                                                    <div class="radio">
                                                        <label>
                                                            <input id="rbn2" class="" name="form-field-radio" type="radio"><span class="text"> Female</span>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-lg-3 control-label">Is Active</label>
                                        <div class="col-lg-8">
                                            <div class="checkbox">
                                                <label>
                                                    <input id="chk1" type="checkbox" checked="checked">
                                                    <span class="text"></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-offset-9 col-sm-12" style=" margin-left: 62%;">
                                        <button class="btn btn-azure" id="btnCreate" type="button">Create</button>
                                        <button class="btn btn-azure" id="btnUpdate" type="button">Update</button>
                                        <button class="btn" id="btnCancel" type="button">Cancel</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="widget-body">
                <table class="table table-striped table-hover table-bordered" id="editabledatatable">
                    <thead>
                        <tr role="row">
                            <th>ID</th>
                            <th>
                                First Name
                            </th>
                            <th>
                                Last Name
                            </th>
                            <th>
                                Email
                            </th>
                            <th>
                                Mobile
                            </th>
                            <th>
                                Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var txt in ViewBag.Data)
                        {
                            <tr>
                                <td>@txt.ID</td>
                                <td>@txt.FirstName</td>
                                <td>@txt.LastName</td>
                                <td>@txt.Email</td>
                                <td>@txt.Mobile</td>
                                <td>
                                    <a href="#" class="btn btn-azure btn-xs edit"><i class="fa fa-edit"></i> Edit</a>
                                    <a href="#" class="btn btn-redcolor btn-xs delete"><i class="fa fa-trash-o"></i> Delete</a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


@section PageScripts{
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link href="~/assets/css/multiple-select.css" rel="stylesheet" />
<link href="~/assets/css/sol.css" rel="stylesheet" />
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<script src="~/Scripts/multiple-select.js"></script>
<script src="~/Scripts/sol.js"></script>


<!--Bootstrap Tags Input-->
<script src="~/assets/js/tagsinput/bootstrap-tagsinput.js"></script>

<link href="~/assets/css/dataTables.bootstrap.css" rel="stylesheet" />
<script src="~/assets/js/datatable/jquery.dataTables.min.js"></script>
<script src="~/assets/js/datatable/ZeroClipboard.js"></script>
<script src="~/assets/js/datatable/dataTables.tableTools.min.js"></script>
<script src="~/assets/js/datatable/dataTables.bootstrap.min.js"></script>
<script src="~/assets/js/datatable/datatables-init.js"></script>
<script src="~/assets/js/bootbox/bootbox.js"></script>
<!--Bootstrap Date Picker-->
<script src="~/assets/js/datetime/bootstrap-datepicker.js"></script>
<!--Bootstrap Time Picker-->
<script src="~/assets/js/datetime/bootstrap-timepicker.js"></script>

<script>

    $(document).ready(function () {
        $("#divnew").hide();
        InitiateEditableAppUserUserDataTable1.init(); 
        $('.date-picker').datepicker();                    
        BindControlMultipleItems(new Array(), "/AppUser/GetAllRoles", $('#ddlMultiple'));
    });

    $("#btnCreate").click(function () {
        if (ValidateFormFields()) {
            var arry = getAllFormValues();
            var arrData = new Array(); var i = 1;
            arrData[0] = "";
            $.each(arry, function (key, value) {
                arrData[i] = value;
                i = i + 1;
            });
            var ctrl = '<a href="#" class="btn btn-azure btn-xs edit"><i class="fa fa-edit"></i> Edit</a><a href="#" class="btn btn-redcolor btn-xs delete"><i class="fa fa-trash-o"></i> Delete</a>';
            var newRow = ["-1", arrData[1], arrData[4], arrData[2], arrData[5], ctrl];
            //$("#editabledatatable").dataTable().fnAddData(newRow);

            SaveEntitytoDB($("#editabledatatable").dataTable(), "/AppUser/SaveEntity", "", arrData, GetIDsFromMultipleSelected("#ddlMultiple"), newRow, "User");
        }
    });
    $("#btnUpdate").click(function () {
        if (ValidateFormFields()) {
            var arry = getAllFormValues();
            var arrData = new Array(); var i = 1;
            arrData[0] = $("#divID").html().trim();
            $.each(arry, function (key, value) {
                arrData[i] = value;
                i = i + 1;
            });
            //var ctrl = '<a href="#" class="btn btn-azure btn-xs edit"><i class="fa fa-edit"></i> Edit</a><a href="#" class="btn btn-redcolor btn-xs delete"><i class="fa fa-trash-o"></i> Delete</a>';
            //var newRow = ["-1", arrData[1], arrData[4], arrData[2], arrData[5], ctrl];
            //$("#editabledatatable").dataTable().fnAddData(newRow);

            var oTable = $("#editabledatatable").dataTable();
            $('#editabledatatable tbody tr').each(function () {
                var nRow = $(this);
                var aData = oTable.fnGetData(nRow);
                if (aData[0] == $("#divID").html().trim()) {
                    oTable.fnUpdate(arrData[1], nRow, 1, false);
                    oTable.fnUpdate(arrData[4], nRow, 2, false);
                    oTable.fnUpdate(arrData[2], nRow, 3, false);
                    oTable.fnUpdate(arrData[5], nRow, 4, false);
                }
            });
            SaveEntitytoDB(oTable, "/AppUser/SaveEntity", $("#divID").html().trim(), arrData, GetIDsFromMultipleSelected("#ddlMultiple"), "", "User");
        }
    });

    $("#btnCancel").click(function () {
        $("#divnew").hide();
    });
    function displayAddDiv() {
        $("#divnew").show();
        $("#btnUpdate").hide();
        $("#btnCreate").show();
        resetAllValues();
    }
</script>
}

